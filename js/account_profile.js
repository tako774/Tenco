lock_process=0;function get_profiles(c,d){0==lock_process&&(lock_process=1,$("#account_password").attr("disabled","disabled"),$("#get_profiles").css("display","none"),$("#message").text("\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u60c5\u5831\u53d6\u5f97\u4e2d..."),exec_get_profiles(c,d),lock_process=0)} function exec_get_profiles(c,d){$.ajax({type:"POST",url:"http://"+location.host+"/api/account_profile_select.cgi",data:{account_name:c,account_password:d},cache:!1,dataType:"xml",success:function(a){var b=$("profile",$("account",$("account_profiles",a))),a=$("profile_classes",$("account_profiles",a));a.each(function(){var a='<optgroup id="property_class_'+$("class_name",$(this)).text()+'" label="'+$("class_display_name",$(this)).text()+'"></optgroup>';$("#property_name").append(a);a='<optgroup id="property_class_hidden_'+ $("class_name",$(this)).text()+'" label="'+$("class_display_name",$(this)).text()+'"></optgroup>';$("#property_name_hidden").append(a)});a.each(function(){var a=$("property",$(this)),b=$("class_name",$(this)).text();a.each(function(){var a='<option id="property_name_'+$("name",$(this)).text()+'" value="'+$("name",$(this)).text()+'">'+$("display_name",$(this)).text()+"</option>";1==$("is_registered",$(this)).text()&&1==$("is_unique",$(this)).text()?$("#property_class_hidden_"+b).append(a):$("#property_class_"+ b).append(a)})});b.each(function(){var a=$("id",$(this)).text(),b=$("name",$(this)).text(),f=$("display_name",$(this)).text(),g=$("value",$(this)).text(),h=$("uri",$(this)).text(),i=$("visibility",$(this)).text();add_current_profile_row(c,d,a,{name:b,display_name:f,value:g,uri:h,visibility:i})});$("#profile_settings").css("display","block");$("#message").text("\u73fe\u5728\u306e\u8a2d\u5b9a\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f\uff08"+getTimeStr(new Date)+"\uff09")},error:function(){$("#message").text("\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u5931\u6557\uff01"); $("#account_password").removeAttr("disabled");$("#get_profiles").css("display","inline");$("#account_password").focus();$("#account_password").select()}})} function add_current_profile_row(c,d,a,b){$("#current_profile_data").append('<tr id="'+a+'"><td id="property_display_name_'+a+'">'+b.display_name+'</td><td><input type="hidden" id="property_value_'+a+'" value="'+b.value+'"></input>'+b.value+'</td><td class="uri suppli"><input type="hidden" id="property_uri_'+a+'" value="'+b.uri+'"></input>'+b.uri+'</td><td><input type="checkbox" id="property_visibility_'+a+'value="1"'+("1"==b.visibility?' checked="checked"':"")+' disabled="disabled"></input></td><td><button type="button" id="delete_profile_'+ a+'">\u524a\u9664</button></td></tr>');$("#property_value_"+a).focus(function(){$(this).select()});$("#property_uri_"+a).focus(function(){$(this).select()});$("#delete_profile_"+a).click(function(){delete_profile(c,d,a,b)})} function add_profile(c,d,a){if(0==lock_process){lock_process=1;var b=$("#add_profile").css("display");$("#add_profile").css("display","none");$("#message").text("\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u60c5\u5831\u767b\u9332\u4e2d...");exec_add_profile(c,d,a);lock_process=0;$("#add_profile").css("display",b)}} function exec_add_profile(c,d,a){$.ajax({type:"POST",url:"http://"+location.host+"/api/account_profile.cgi",data:{account_name:c,account_password:d,property_name:a.name,property_value:a.value,property_uri:a.uri,property_visibility:a.visibility},cache:!1,dataType:"xml",success:function(b){var e=$("profile",$("account",$("account_profile",$(b)))),b=$("id",$(e)).text(),e=$("is_unique",$(e)).text();add_current_profile_row(c,d,b,a);"1"==e&&(b=$("#property_name_"+a.name).parent().get(0).id.replace("property_class_", ""),$("#property_name_"+a.name).remove().appendTo($("#property_class_hidden_"+b)));$("#property_value").val("");$("#property_uri").val("");$("#property_visibility").attr("checked","checked");$("#message").text("\u767b\u9332\u3057\u307e\u3057\u305f\uff08"+getTimeStr(new Date)+"\uff09")},error:function(a){$("#message").text("\u767b\u9332\u5931\u6557\uff01\uff08"+getTimeStr(new Date)+"\uff09\n"+a.responseText)}})} function delete_profile(c,d,a,b){0==lock_process&&(lock_process=1,$("#message").text("\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u60c5\u5831\u524a\u9664\u4e2d..."),exec_delete_profile(c,d,a,b),lock_process=0)} function exec_delete_profile(c,d,a,b){$.ajax({type:"POST",url:"http://"+location.host+"/api/account_profile_delete.cgi",data:{account_name:c,account_password:d,account_profile_id:a},cache:!1,dataType:"string",success:function(){$("#"+a).remove();var c=$("#property_name_"+b.name).parent().get(0).id;c.match(/property_class_hidden_/)&&(c=c.replace("property_class_hidden_",""),$("#property_name_"+b.name).remove().appendTo($("#property_class_"+c)));$("#message").text("\u524a\u9664\u3057\u307e\u3057\u305f\uff08"+ getTimeStr(new Date)+"\uff09")},error:function(a){$("#message").text("\u524a\u9664\u5931\u6557\uff01\uff08"+getTimeStr(new Date)+"\uff09\n"+a.responseText)}})};